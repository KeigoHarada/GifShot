# 開発メモ

1. ソフトウェア概要
   GifShotは、常駐型の軽量GIF録画ツールです。
   ユーザーはホットキー操作のみで画面録画を開始・停止できる。
   録画範囲はユーザーが選択可能
   録画結果は自動でGIFファイルとして保存、かつクリップボードにもコピーされる

2. 対象ユーザー
   簡単に画面操作をGIFで共有したい人
   マニュアルやチュートリアル作成者
   SNSやチャットで手軽に画面録画を送りたい人

3. 基本的な動作
   1. 常駐起動
   2. バックグラウンドで立ち上がる
   3. トレイ（Windows） / メニューバー（Mac）に常駐
   4. 録画開始
   5. ホットキー `Cmd + Shift + 6` で起動
   6. デスクトップ画面上に半透明オーバーレイ表示
   7. ユーザーがマウスで録画範囲を選択
   8. 選択完了と同時に録画開始
   9. 再度ホットキー `Cmd + Shift + 6` を押すと録画終了 → GIF生成
   10. 保存
       1. GIFは所定のフォルダに 日時ベースのファイル名 で保存
       例： GifShot_2025-09-16_22-30-05.gif
       2. クリップボードコピー
       録画終了後、GIFは 自動でクリップボードにコピーされてそのままペースト可能

4. 操作フロー
   バックグラウンド常駐
   ホットキー押下 → 録画範囲選択
   範囲確定 → 録画開始
   ホットキー押下 → 録画停止
   GIF生成・保存・クリップボードコピー
   通知（録画完了）

---

5. プロトタイプ設計（MVP）
   1. 機能スコープ
      - メニューバー常駐（`MenuBarExtra`）
      - トグル操作：録画開始/停止、アプリ終了
      - ホットキー：`Cmd+Shift+6`（プロトでは擬似実装→本実装は後続）
      - 範囲選択オーバーレイ：矩形選択（最小UI）
      - 画面録画：`ScreenCaptureKit` による領域キャプチャ（初期は全画面→後で矩形切り出し）
      - GIFエンコード：`ImageIO`（`CGImageDestination`）、デフォルト 15fps、無限ループ
      - 保存：`~/Downloads/GifShot/`（存在しなければ作成）に日時ファイル名で保存
      - クリップボードコピー：`NSPasteboard` へGIFデータを設定
      - 通知：録画完了のローカル通知（将来対応）

   2. 非機能要件（プロト）
      - macOS 13+（`MenuBarExtra`/`ScreenCaptureKit`対応のため）
      - 消費CPU/メモリはまずは許容範囲で動作確認（最適化は後続）
      - 例外・エラー時はユーザーに短いアラート表示

6. アーキテクチャ方針
   - 構成
     - `AppModel`：アプリ全体の状態管理（`ObservableObject`）
     - `HotkeyManager`：グローバルホットキーの登録/解除
     - `SelectionOverlayView`：範囲選択UI
     - `Recorder`：`ScreenCaptureKit` 録画制御
     - `GifEncoder`：フレームからGIF生成（`ImageIO`）
     - `SaveService`：保存先ディレクトリ管理と書き込み
     - `ClipboardService`：クリップボード転送
     - `NotificationService`：完了通知
   - 依存関係
     - `AppModel` が各サービスを保持し、UIからの意図をコーディネート
   - 状態遷移
     - `idle` → `selecting` → `recording` → `encoding` → `completed`/`failed`

7. ユースケース概要
   - 録画開始：メニューバーまたはホットキー → オーバーレイ表示 → 矩形確定で録画開始
   - 録画停止：メニューバーまたはホットキー → 録画停止 → GIF生成 → 保存/クリップボード

8. 権限/サンドボックス
   - 画面収録の権限（システム設定）を要求
   - 保存に関してはプロトでは `~/Downloads/GifShot` を使用
   - サンドボックスは後続で `files.user-selected.read-write` も検討（保存先選択対応時）

9. 失敗時の扱い
   - 権限不足・保存失敗・エンコード失敗時はメニューバーのドロップダウン内にエラーメッセージ表示

10. ロードマップ

- M0: メニューバー常駐、トグル、ダミーホットキー、ダミー録画（配線）
- M1: 範囲選択 → `ScreenCaptureKit` 実録画 → GIF生成/保存/コピー
- M2: 設定画面（fps/品質/保存先/ホットキー変更）、通知、安定化
